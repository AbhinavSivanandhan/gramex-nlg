<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>Natural Language Generation</title>
</head>

<body>
    <link rel="stylesheet" href="ui/bootstraptheme.css" /> <!-- Add bootstrap -->
    <link rel="stylesheet" href="ui/font-awesome/css/font-awesome.min.css">
    <div class="formhandler" data-src="preview"></div> <!-- Insert component here -->
    <!-- Include JS dependencies  -->
    <script src="ui/lodash/lodash.min.js"></script>
    <script src="ui/jquery/dist/jquery.min.js"></script>
    <script src="ui/popper.js/dist/umd/popper.min.js"></script>
    <script src="ui/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="ui/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="ui/g1/dist/g1.min.js"></script>
    <script src="nlg.js"></script>
    <script>
        // Render the FormHandler table

        $.fn.selectpicker.Constructor.BootstrapVersion = '4'
        var df = null;
        var args = null;
        var templates = [];
        var currentEventHandlers = {};
        var currentEditIndex = null;
        var currentSpanId = null;
        var grammarOptions = []
        var narrativeName = "";
        // setContextMenu();
        $('.formhandler').on('load', renderPreview);
        $('.formhandler').formhandler();
    </script>
    <div class="d-flex">
        <p>Upload JSON config</p>
        <input type="file" id="config-upload" enctype="multipart/form-data" />
        <input class="form-control mx-1 underline border-success"
        id="narrative-name-editor" placeholder="Name the Narrative">
    </div>
    <form id="myform" enctype="multipart/form-data">
        <div>
            <label for="textbox">Type Something</label>:
            <div>
                <textarea id="textbox" name="textbox" style="font-family:monospace"></textarea>
            </div>
        </div>
        <p>
            <button id="inspect" type="button" title="Add to Template"
                class="btn btn-primary">
                <i class="fa fa-plus-square"></i>
            </button>
        </p>
    </form>
    <p id="template-preview" style="font-family:monospace"></p>
    <br>
    <div class="d-flex">
        <button id="download-btn" type="button" title="Download Narrative" class="btn btn-primary">
            <i class="fa fa-download"></i>
        </button>
        <div class="form-check">
            <label class="form-check-label">
            <input class="form-check-input" type="checkbox" id="download-data-cb" checked>Include Data
            </label>
        </div>
        <button id="download-config-btn" type="button" title="Download Config" class="btn btn-success">
            <i class="fa fa-download"></i>
        </button>
    </div>
    <!--
    <button id="clear-tmpls" title="Clear Narrative" type="button" class="btn btn-danger">
        <i class="fa fa-trash"></i>
    </button>
    -->
    <div class="modal fade" id="template-settings" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h6>Template Settings:</h6></div>
                <div id="tmpllist" class="modal-body">
                    <div>
                        <div class="d-flex">
                            <input class="form-control mx-1 underline border-success"
                            id="tmpl-name-editor" placeholder="Name the template">
                            <button id="tmpl-name-btn" type="button" class="btn btn-primary success">
                                <i class="fa fa-check"></i>
                            </button>
                        </div>
                        <div class="d-flex">
                            <div class="text-middle h6 mr-2 p-2">
                                <div class="align-center" id="tmpl-setting-preview"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <input class="form-control mx-1 underline border-success"
                            id="condition-editor" placeholder="Add condition">
                            <button id="condition-btn" type="button" class="btn btn-primary success">
                                <i class="fa fa-check"></i>
                            </button>
                        </div>
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="fh-arg-setter">
                            <label class="custom-control-label" for="fh-arg-setter">Set current data</label>
                            </div>
                        <br>
                        <textarea id="edit-template" class="align-center"
                        name="templateditor"
                        style="font-family:monospace; font-size:10pt; width: 50em"></textarea>
                        <br>
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Token</th>
                                    <th scope="col">Search Results</th>
                                    <th scope="col">Grammar</th>
                                    <th scope="col">Make Variable</th>
                                    <th scope="col"><!--Remove--></th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <!--dummy code starts-->
                            </tbody>
                        </table>
                        <div id="srdd"></div>
                        <button id="check-template" title="Run template" type="button" class="btn btn-primary">
                            <i class="fa fa-play"></i>
                        </button>
                        <button id="save-template" title="Save Template" type="button" class="btn btn-primary" disabled>
                            <i class="fa fa-save"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Template preview -->
    <script>
        document.getElementById("download-btn").addEventListener("click", downloadNarrative);
        document.getElementById("download-config-btn").addEventListener("click", downloadConfig);
        document.getElementById("config-upload").addEventListener("change", uploadConfig, false);
        document.getElementById("inspect").addEventListener("click", addToNarrative);
        document.getElementById("check-template").addEventListener("click", checkTemplate);
        var saveBtn = document.getElementById("save-template")
        saveBtn.addEventListener("click", saveTemplate);
        document.getElementById("edit-template").addEventListener('focus', function (e) {saveBtn.disabled = false})
        document.getElementById("condition-btn").addEventListener("click", addCondition);
        document.getElementById("tmpl-name-btn").addEventListener("click", addName);
        document.getElementById("fh-arg-setter").addEventListener("change", changeFHSetter)
        // document.getElementById("clear-tmpls").addEventListener('click', clearNarrative);
        document.getElementById("textbox").cols = 119;
        document.getElementById("edit-template").cols = 69;
        document.getElementById("edit-template").rows = 10;
        $.ajax({
            type: "GET",
            url: "get-gramopts",
            success: function (resp) { grammarOptions = resp }
        })
    </script>
</body>

</html>